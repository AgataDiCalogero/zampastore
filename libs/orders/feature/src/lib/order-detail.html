@if (state$ | async; as state) { @if (state.status === 'ready') {
<section class="order-detail section">
  <nav class="order-breadcrumb">
    <a [routerLink]="['/ordini']">Ordini</a>
    <span>/</span>
    <span>{{ state.order.id }}</span>
  </nav>
  <p-card class="order-card" header="Dettaglio ordine">
    <div class="order-meta">
      <div>
        <span class="label">Riferimento</span>
        <span class="value">#{{ getShortId(state.order.id) }}</span>
      </div>
      <div>
        <span class="label">Data</span>
        <span class="value">
          {{ state.order.createdAt | date: 'dd/MM/yyyy' }}
        </span>
      </div>
      <div>
        <span class="label">Stato</span>
        <span
          class="status-chip"
          [class]="'status-chip status-' + statusFor(state.order.status).tone"
        >
          {{ statusFor(state.order.status).label }}
        </span>
      </div>
      <div>
        <span class="label">Totale</span>
        <span class="value">
          {{ state.order.totalCents / 100 | number: '1.2-2' }} €
        </span>
      </div>
    </div>

    <h4>Spedizione</h4>
    <div class="shipping-box">
      <div>
        {{ state.order.shippingAddress.firstName }} {{
        state.order.shippingAddress.lastName }}
      </div>
      <div>{{ state.order.shippingAddress.address }}</div>
      <div>
        {{ state.order.shippingAddress.postalCode }} {{
        state.order.shippingAddress.city }}
      </div>
      <div>{{ state.order.shippingAddress.country }}</div>
    </div>

    <h4>Prodotti</h4>
    @defer (on viewport) {
    <p-table
      [value]="state.order.items"
      dataKey="productId"
      responsiveLayout="scroll"
    >
      <ng-template pTemplate="header">
        <tr>
          <th scope="col">Prodotto</th>
          <th scope="col">Prezzo</th>
          <th scope="col">Qtà</th>
          <th scope="col">Totale</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item>
        <tr>
          <td>{{ item.name }}</td>
          <td>{{ item.unitPriceCents / 100 | number: '1.2-2' }} €</td>
          <td>{{ item.qty }}</td>
          <td>{{ item.lineTotalCents / 100 | number: '1.2-2' }} €</td>
        </tr>
      </ng-template>
    </p-table>
    } @placeholder {
    <div class="order-skeleton">
      <p-skeleton height="28px"></p-skeleton>
      <p-skeleton height="28px"></p-skeleton>
      <p-skeleton height="28px"></p-skeleton>
    </div>
    }

    <div class="order-actions">
      <button
        pButton
        type="button"
        class="p-button-text"
        [routerLink]="['/ordini']"
      >
        Torna agli ordini
      </button>
    </div>
  </p-card>
</section>
} @else if (state.status === 'not-found') {
<section class="order-empty section">
  <div class="empty-state">
    <i class="pi pi-inbox"></i>
    <h3>Ordine non trovato</h3>
    <p>Controlla il codice ordine o torna alla lista.</p>
    <button pButton type="button" [routerLink]="['/ordini']">
      Vai agli ordini
    </button>
  </div>
</section>
} @else if (state.status === 'error') {
<section class="order-empty section">
  <div class="empty-state">
    <i class="pi pi-exclamation-triangle"></i>
    <h3>Errore di caricamento</h3>
    <p>Riprova tra poco.</p>
  </div>
</section>
} @else {
<section class="order-detail section">
  <p-card class="order-card" header="Dettaglio ordine">
    <div class="order-skeleton">
      <p-skeleton height="28px"></p-skeleton>
      <p-skeleton height="28px"></p-skeleton>
      <p-skeleton height="28px"></p-skeleton>
    </div>
  </p-card>
</section>
} }

@if (productState(); as state) { @if (state.status === 'ready') {
<section class="product-detail">
  <p-card class="product-detail-card" [header]="state.product.name">
    <ng-template pTemplate="content">
      <div class="product-detail-grid">
        <div class="product-gallery">
          <!-- Main Image with Navigation Arrows -->
          <div class="gallery-main">
            @if (images().length > 1) {
            <button
              class="gallery-arrow gallery-prev"
              (click)="prevImage()"
              aria-label="Immagine precedente"
            >
              <i class="pi pi-chevron-left"></i>
            </button>
            }

            <div class="gallery-image-wrapper">
              @if (images().length > 0) {
              <img
                [src]="images()[selectedImageIndex()]"
                [alt]="state.product.name"
              />
              } @else {
              <div class="product-image-fallback">
                <i class="pi pi-image"></i>
                <span>No image</span>
              </div>
              }
            </div>

            @if (images().length > 1) {
            <button
              class="gallery-arrow gallery-next"
              (click)="nextImage()"
              aria-label="Immagine successiva"
            >
              <i class="pi pi-chevron-right"></i>
            </button>
            }
          </div>

          <!-- Thumbnails -->
          @if (images().length > 1) {
          <div class="gallery-thumbnails">
            @for (img of images(); track $index) {
            <button
              class="gallery-thumb"
              [class.active]="selectedImageIndex() === $index"
              (click)="selectImage($index)"
              [attr.aria-label]="'Miniatura ' + ($index + 1)"
            >
              <img [src]="img" [alt]="'Miniatura ' + ($index + 1)" />
            </button>
            }
          </div>
          }
        </div>
        <div class="product-detail-info">
          <p class="product-detail-price">
            {{ state.product.priceCents / 100 | number: '1.2-2' }} €
          </p>
          @if (state.product.description) {
          <p class="product-detail-description">
            {{ state.product.description }}
          </p>
          }

          <div class="product-detail-qty">
            <span class="product-detail-label">Quantità</span>
            <p-inputNumber
              [formControl]="qtyControl"
              [min]="1"
              [showButtons]="true"
              buttonLayout="horizontal"
              [minFractionDigits]="0"
              incrementButtonIcon="pi pi-plus"
              decrementButtonIcon="pi pi-minus"
              ariaLabel="Quantità"
            >
            </p-inputNumber>
          </div>

          <button
            class="product-detail-cta"
            pButton
            type="button"
            icon="pi pi-shopping-cart"
            label="Aggiungi al carrello"
            (click)="addToCart(state.product)"
          ></button>
        </div>
      </div>
    </ng-template>

    <ng-template pTemplate="footer">
      <button
        pButton
        type="button"
        icon="pi pi-arrow-left"
        label="Torna ai prodotti"
        [routerLink]="['/prodotti']"
      ></button>
    </ng-template>
  </p-card>
</section>
} @else if (state.status === 'loading') {
<section class="product-detail">
  <div class="product-detail-skeleton">
    <div class="product-detail-media">
      <p-skeleton height="320px"></p-skeleton>
    </div>
    <div class="product-detail-info">
      <p-skeleton width="60%" height="24px"></p-skeleton>
      <p-skeleton width="30%" height="20px"></p-skeleton>
      <div class="product-detail-qty">
        <p-skeleton width="80px" height="18px"></p-skeleton>
        <p-skeleton width="160px" height="44px"></p-skeleton>
      </div>
      <p-skeleton width="200px" height="44px"></p-skeleton>
    </div>
  </div>
</section>
} @else {
<section class="product-empty">
  <div class="empty-state">
    <i class="pi pi-search"></i>
    <h3>Prodotto non trovato</h3>
    <p>Il prodotto che cerchi non è disponibile.</p>
    <button pButton type="button" [routerLink]="['/prodotti']">
      Torna al catalogo
    </button>
  </div>
</section>
} }

<p-toast key="app" position="top-right">
  <ng-template pTemplate="message" let-message>
    <div class="toast-content">
      <div class="toast-text">
        <div class="toast-summary">{{ message.summary }}</div>
        <div class="toast-detail">{{ message.detail }}</div>
      </div>
      @if (message?.data?.actionLabel) {
      <button
        pButton
        type="button"
        class="p-button-text p-button-sm"
        (click)="message.data.action()"
      >
        {{ message.data.actionLabel }}
      </button>
      }
    </div>
  </ng-template>
</p-toast>

<header class="app-header">
  <p-menubar [model]="[]" class="app-menubar">
    <ng-template pTemplate="start">
      <a
        class="brand"
        [routerLink]="['/']"
        aria-label="Vai alla home ZampaStore"
      >
        <svg
          class="brand-icon"
          viewBox="0 0 64 64"
          aria-hidden="true"
          focusable="false"
          fill="currentColor"
        >
          <circle cx="18" cy="22" r="6"></circle>
          <circle cx="28" cy="14" r="6"></circle>
          <circle cx="36" cy="14" r="6"></circle>
          <circle cx="46" cy="22" r="6"></circle>
          <ellipse cx="32" cy="40" rx="16" ry="12"></ellipse>
        </svg>
        <span>ZampaStore</span>
      </a>
      <nav class="desktop-nav" aria-label="Navigazione principale">
        @for (link of desktopLinks(); track link.label) { @if (link.routerLink)
        {
        <a
          class="desktop-nav-link"
          [class.desktop-nav-link--cta]="link.id === 'auth'"
          [routerLink]="link.routerLink"
          routerLinkActive="is-active"
          [routerLinkActiveOptions]="{ exact: link.routerLink === '/' }"
        >
          @if (link.icon) {
          <i class="{{ link.icon }}"></i>
          }
          <span>{{ link.label }}</span>
        </a>
        } @else {
        <button
          type="button"
          class="desktop-nav-link"
          [class.desktop-nav-link--cta]="link.id === 'auth'"
          (click)="handleMobileAction(link.command)"
        >
          @if (link.icon) {
          <i class="{{ link.icon }}"></i>
          }
          <span>{{ link.label }}</span>
        </button>
        } }
      </nav>
    </ng-template>
    <ng-template pTemplate="end">
      <div class="menubar-meta">
        <span>
          <i class="pi pi-truck"></i>
          Consegna 24/48h
        </span>
        <span>
          <i class="pi pi-undo"></i>
          Resi facili
        </span>
        <span>
          <i class="pi pi-lock"></i>
          Pagamenti sicuri
        </span>
      </div>
      @if (user()) {
      <!-- User State: Logout -->
      <button
        type="button"
        class="desktop-nav-link desktop-nav-link--cta menubar-auth"
        (click)="handleMobileAction(performLogout.bind(this))"
      >
        <i class="pi pi-sign-out"></i>
        <span>Esci</span>
      </button>
      } @else {
      <!-- Guest State: Login + Register -->
      <div class="desktop-auth-group">
        <a
          class="desktop-nav-link desktop-nav-link--cta menubar-auth"
          routerLink="/login"
        >
          <i class="pi pi-user"></i>
          <span>Accedi</span>
        </a>
      </div>
      }
      <button
        pButton
        type="button"
        class="p-button-text mobile-toggle"
        icon="pi pi-bars"
        aria-label="Apri menu"
        (click)="toggleMobileMenu()"
      ></button>
    </ng-template>
  </p-menubar>
</header>

<button
  type="button"
  class="mobile-nav-backdrop"
  [class.is-open]="mobileMenuOpen()"
  aria-label="Chiudi menu"
  (click)="closeMobileMenu()"
></button>
<dialog
  class="mobile-nav"
  [class.is-open]="mobileMenuOpen()"
  aria-modal="true"
  [attr.aria-hidden]="!mobileMenuOpen()"
>
  <div class="mobile-nav-header">
    @if (user(); as u) {
    <div class="mobile-user-header">
      <span class="greeting">Ciao, {{ u.name || 'Utente' }}!</span>
      <button
        type="button"
        class="btn-logout-link"
        (click)="handleMobileAction(performLogout.bind(this))"
      >
        Esci
      </button>
    </div>
    } @else {
    <div class="mobile-guest-header amazon-style">
      <div class="welcome-text">
        <strong>Ciao, Accedi</strong>
        <p>Account e liste</p>
      </div>
      <div class="mobile-auth-actions-single">
        <a
          class="btn-mobile-auth-primary"
          routerLink="/login"
          (click)="closeMobileMenu()"
        >
          Accedi al tuo account
        </a>
        <div class="auth-fallback">
          <span>Nuovo cliente?</span>
          <a routerLink="/registrazione" (click)="closeMobileMenu()"
            >Inizia qui.</a
          >
        </div>
      </div>
    </div>
    }
    <button
      pButton
      type="button"
      class="p-button-text close-btn"
      icon="pi pi-times"
      aria-label="Chiudi menu"
      (click)="closeMobileMenu()"
    ></button>
  </div>
  <nav class="mobile-nav-links" aria-label="Navigazione mobile">
    @for (link of mobileLinks(); track link.label) { @if (link.routerLink) {
    <a
      class="mobile-nav-link"
      [class.mobile-nav-link--cta]="link.id === 'auth'"
      [routerLink]="link.routerLink"
      routerLinkActive="is-active"
      [routerLinkActiveOptions]="{ exact: link.routerLink === '/' }"
      (click)="closeMobileMenu()"
    >
      @if (link.icon) {
      <i class="{{ link.icon }}"></i>
      }
      <span>{{ link.label }}</span>
      @if (link.id === 'cart' && cartCount() > 0) {
      <span class="nav-badge">{{ cartCount() }}</span>
      }
    </a>
    } @else {
    <button
      type="button"
      class="mobile-nav-button"
      [class.mobile-nav-button--cta]="link.id === 'auth'"
      [attr.aria-label]="link.label"
      (click)="handleMobileAction(link.command)"
    >
      @if (link.icon) {
      <i class="{{ link.icon }}"></i>
      }
      <span>{{ link.label }}</span>
      @if (link.id === 'cart' && cartCount() > 0) {
      <span class="nav-badge">{{ cartCount() }}</span>
      }
    </button>
    } }
  </nav>
</dialog>

<main class="app-content">
  <div class="page">
    <div class="container">
      <router-outlet></router-outlet>
    </div>
  </div>
</main>

<footer class="app-footer">
  <div class="container footer-content">
    <div>
      <strong>ZampaStore</strong>
      <p class="text-muted">Benessere quotidiano per cani e gatti.</p>
    </div>
    <div class="footer-links">
      <span>Â© 2026 ZampaStore</span>
      <span>Assistenza clienti 7 giorni su 7</span>
    </div>
  </div>
</footer>
